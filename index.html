<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ผลหวยฮานอย (อัปเดตทุก 1 นาที)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .container { width: 100%; max-width: 800px; background-color: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .lottery-section { margin-bottom: 30px; }
        h2 { text-align: center; color: #333; font-weight: 700; margin-bottom: 15px; font-size: 1.8em; }
        .lottery-table { width: 100%; border-collapse: collapse; text-align: center; }
        .lottery-table th, .lottery-table td { padding: 12px 15px; border: 1px solid #dddddd; transition: background-color 0.5s ease; }
        .lottery-table thead tr { background-color: #4CAF50; color: white; }
        .lottery-table th { font-weight: 700; font-size: 1.1em; }
        .date, .waiting, .number-highlight { color: #D32F2F; font-weight: 700; }
        .loader { text-align: center; font-weight: bold; color: #555; }
        .updated { background-color: #e8f5e9; }
        .footer-notice { text-align: center; color: #888; font-size: 0.8em; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="lottery-section">
            <h2>ผลฮานอยพิเศษ</h2>
            <table class="lottery-table">
                <thead>
                    <tr>
                        <th>งวดวันที่</th>
                        <th>4ตัว</th>
                        <th>3ตัว</th>
                        <th>2ตัวบน</th>
                        <th>2ตัวล่าง</th>
                    </tr>
                </thead>
                <tbody id="hanoy-special">
                    <tr>
                        <td class="date">...</td>
                        <td class="loader" colspan="4">กำลังโหลดผล...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="lottery-section">
            <h2>ผลหวยฮานอยปกติ</h2>
            <table class="lottery-table">
                <thead>
                    <tr>
                        <th>งวดวันที่</th>
                        <th>4ตัว</th>
                        <th>3ตัว</th>
                        <th>2ตัวบน</th>
                        <th>2ตัวล่าง</th>
                    </tr>
                </thead>
                <tbody id="hanoy-normal">
                     <tr>
                        <td class="date">...</td>
                        <td class="loader" colspan="4">กำลังโหลดผล...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="lottery-section">
            <h2>ผลฮานอยVIP</h2>
            <table class="lottery-table">
                <thead>
                    <tr>
                        <th>งวดวันที่</th>
                        <th>4ตัว</th>
                        <th>3ตัว</th>
                        <th>2ตัวบน</th>
                        <th>2ตัวล่าง</th>
                    </tr>
                </thead>
                <tbody id="hanoy-vip">
                     <tr>
                        <td class="date">...</td>
                        <td class="loader" colspan="4">กำลังโหลดผล...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <p class="footer-notice">ข้อมูลจะอัปเดตอัตโนมัติทุก 1 นาที | ข้อมูลจาก huaysong.net</p>

    <script>
        const PROXY_URL = 'https://cors-anywhere.herokuapp.com/';
        const TARGET_URL = 'https://huaysong.net/huayhanoy/';

        function showLoadingState(tbodyId) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = `<tr><td class="date">...</td><td class="loader" colspan="4">กำลังอัปเดต...</td></tr>`;
        }

        async function fetchLotteryResults() {
            try {
                const response = await fetch(PROXY_URL + TARGET_URL);
                
                console.log('Response Status:', response.status);  // ตรวจสอบสถานะของการตอบกลับ
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const text = await response.text();
                
                console.log('Received HTML:', text);  // ตรวจสอบ HTML ที่ได้รับ

                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                // --- Logic เพื่อดึงข้อมูล ---
                const getResults = (headingText, targetTbodyId) => {
                    const targetTbody = document.getElementById(targetTbodyId);
                    const allHeadings = doc.querySelectorAll('h2, h3');
                    let foundTable = null;

                    for (const h of allHeadings) {
                        if (h.textContent.includes(headingText)) {
                            let sibling = h.nextElementSibling;
                            while (sibling) {
                                if (sibling.tagName === 'TABLE') {
                                    foundTable = sibling;
                                    break;
                                }
                                if (sibling.querySelector('table')) {
                                    foundTable = sibling.querySelector('table');
                                    break;
                                }
                                sibling = sibling.nextElementSibling;
                            }
                            if (foundTable) break;
                        }
                    }

                    if (foundTable) {
                        targetTbody.innerHTML = foundTable.querySelector('tbody').innerHTML;
                        const lastCell = targetTbody.querySelector('tr:first-child td:last-child');
                        if (lastCell) lastCell.classList.add('number-highlight');
                        const firstRow = targetTbody.querySelector('tr:first-child');
                        if (firstRow) {
                            firstRow.classList.add('updated');
                            setTimeout(() => firstRow.classList.remove('updated'), 2000);
                        }
                    } else {
                        targetTbody.innerHTML = `<tr><td colspan="5" class="loader">ไม่พบตารางผล (${headingText})</td></tr>`;
                    }
                };

                getResults('พิเศษ', 'hanoy-special');
                getResults('ปกติ', 'hanoy-normal');
                getResults('VIP', 'hanoy-vip');
            } catch (error) {
                console.error('Error fetching lottery data:', error);
                document.querySelectorAll('.loader').forEach(el => {
                    el.parentElement.innerHTML = `<td colspan="5" class="loader">โหลดข้อมูลล้มเหลว</td>`;
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchLotteryResults();
            setInterval(() => {
                console.log('Refreshing data...');
                showLoadingState('hanoy-special');
                showLoadingState('hanoy-normal');
                showLoadingState('hanoy-vip');
                fetchLotteryResults();
            }, 60000);
        });
    </script>
</body>
</html>
